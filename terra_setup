#!/bin/bash

# apt updates and housekeeping

sudo apt update

sudo apt install -y unzip wget

# Terraform install

	#	grep latest version
VERSN="$(curl -sL "https://releases.hashicorp.com/terraform/" | grep -v beta | grep -Po "_(\d*\.?){3}" | sed "s/.//" | sort -V | tail -1)"
	#	grep latest version

wget https://releases.hashicorp.com/terraform/${VERSN}/terraform_${VERSN}_linux_amd64.zip

unzip terraform_*_linux_*.zip

echo move to bin
read

sudo mv terraform /usr/local/bin

echo remove zip
read

rm terraform_*_linux_*.zip

echo Terraform was installed
terraform --version

echo Continue to Azure setup
read

curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash

echo Continue to Azure login

az login

read

terraform init

echo Terraform initialized

terraform validate

terraform apply
